{% extends 'base.html.twig' %}
{% block title %}Modifier mon avis — {{ review.recipe.title }} | Orange Chef{% endblock %}

{% block body %}
    <div class="container" style="max-width:760px">
        <h1 class="mb-3">Modifier mon avis</h1>

        <div class="mb-3">
            <a class="btn btn-sm btn-outline-secondary"
               href="{{ path('app_recipe_show', { id: review.recipe.id, _fragment: 'reviews' }) }}">
                ← Retour à la recette
            </a>
        </div>

        <div class="card shadow-sm">
            <div class="card-body">
                {% form_theme form 'bootstrap_5_layout.html.twig' %}
                {{ form_start(form, { attr: { novalidate: 'novalidate' } }) }}

                {# erreurs globales #}
                {% if form_errors(form) is not empty %}
                    <div class="alert alert-danger mb-3">{{ form_errors(form) }}</div>
                {% endif %}

                {% if form.rating is defined %}
                    <fieldset class="mb-3">
                        <legend class="form-label mb-2">Votre note</legend>
                        <div class="rating-stars d-flex gap-2 flex-row-reverse align-items-center">
                            {% for i in 5..1 %}
                                <input
                                    type="radio"
                                    id="{{ form.rating.vars.id }}_{{ i }}"
                                    name="{{ form.rating.vars.full_name }}"
                                    value="{{ i }}"
                                    class="visually-hidden"
                                    {% if form.rating.vars.value == i %}checked{% endif %}
                                />
                                <label for="{{ form.rating.vars.id }}_{{ i }}" title="{{ i }} sur 5"
                                       class="star-label">★</label>
                            {% endfor %}
                        </div>
                        {{ form_errors(form.rating) }}
                    </fieldset>
                {% endif %}

                {% if form.comment is defined %}
                    <div class="mb-3">
                        {{ form_label(form.comment, 'Votre commentaire', {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.comment, {'attr': {
                            'class': 'form-control',
                            'rows': 5,
                            'placeholder': 'Quelques mots sur la recette…'
                        }}) }}
                        {{ form_errors(form.comment) }}
                    </div>
                {% endif %}

                {{ form_rest(form) }}

                <div class="d-flex gap-2">
                    <button class="btn btn-primary">Enregistrer</button>
                    <a class="btn btn-outline-secondary"
                       href="{{ path('app_recipe_show', { id: review.recipe.id, _fragment: 'reviews' }) }}">
                        Annuler
                    </a>
                </div>

                {{ form_end(form) }}
            </div>
        </div>

        <p class="text-muted mt-3" style="font-size:.95rem">
            {% if not is_granted('ROLE_ADMIN') %}
                À la modification, votre avis repasse en <strong>modération</strong>.
            {% else %}
                Vous êtes admin : la mise à jour reste <strong>approuvée</strong>.
            {% endif %}
        </p>
    </div>

    <style>
        .rating-stars input { position: absolute; left: -9999px; }
        .rating-stars .star-label {
            font-size: 28px; line-height: 1; cursor: pointer;
            color: #d6d6d6; user-select: none; transition: transform .15s ease, color .15s ease;
        }
        .rating-stars .star-label:hover,
        .rating-stars .star-label:hover ~ .star-label { color:#ff9800; transform: translateY(-1px); }
        .rating-stars input:checked ~ .star-label { color:#ff9800; }
        /* focus accessible via label */
        .rating-stars input:focus + .star-label { outline: 2px solid rgba(255,152,0,.35); border-radius:6px; }
    </style>
{% endblock %}
