{# templates/base.html.twig #}
<!DOCTYPE html>
<html lang="{{ app.request.locale|default('fr') }}">
<head>
    <meta charset="UTF-8">

    {# --- SEO / Open Graph --- #}
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Orange Chef">
    <meta property="og:title" content="{% block og_title %}{{ block('title') }}{% endblock %}">
    <meta property="og:description" content="Recettes ensoleillées, astuces anti-gaspi et fraîcheur vitaminée.">
    <meta property="og:image" content="{{ asset('images/og-default.jpg') }}">
    <meta property="og:url" content="{{ app.request.uri|default('') }}">
    <meta name="twitter:card" content="summary_large_image">

    <title>{% block title %}Orange Chef{% endblock %}</title>

    {# --- Favicon & icons --- #}
    <link rel="icon" href="{{ asset('favicon.svg') }}?v=2" type="image/svg+xml">
    <link rel="icon" href="{{ asset('favicon-32.png') }}?v=2" sizes="32x32" type="image/png">
    <link rel="shortcut icon" href="{{ asset('favicon-32.png') }}?v=2"> {# vieux navigateurs #}
    <link rel="apple-touch-icon" href="{{ asset('apple-touch-icon.png') }}?v=2">


    {# --- Bootswatch + Icons (optionnels) --- #}
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/litera/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

    {% block stylesheets %}
        {{ importmap('app') }}
        <link rel="stylesheet" href="{{ asset('styles/theme-citrus.css') }}">
    {% endblock %}

    {# --- Styles nav compact (bouton + panneau) --- #}
    <style>
        /* Menu collant (version simple) */

        /* Variables */
        :root{
            --oc-orange:#ff9800;
            --oc-bg:#fff7eb;
            --oc-pill:#fff;
            --oc-border:#ffd6a6;
            --oc-shadow:0 8px 24px rgba(0,0,0,.08);
            --oc-ring:0 0 0 3px rgba(255,152,0,.20);
            --oc-text:#1f2937;
        }
        @media (prefers-color-scheme: dark){
            :root{
                --oc-bg:#1b1205;
                --oc-pill:#1d1610;
                --oc-border:#3b2a17;
                --oc-shadow:0 10px 28px rgba(0,0,0,.35);
                --oc-text:#f7f2eb;
            }
        }

        /* Layout nav */
        .nav-container{display:flex;justify-content:space-between;align-items:center;gap:16px}
        .main-nav{ position: sticky; top: 64px; z-index: 20; box-shadow:0 6px 18px rgba(0,0,0,.04); }

        /* Toggle du mega-menu */
        #ocMenuToggle{
            display:flex;align-items:center;gap:.5rem;
            background:var(--oc-pill); color:#1f2430;
            border:1px solid var(--oc-border); border-radius:999px;
            padding:.35rem .75rem; cursor:pointer; font-weight:700;
            box-shadow:0 1px 0 rgba(16,24,40,.06);
        }
        #ocMenuToggle:hover{ background:#fff; }
        #ocMenuToggle .chev{ transition: transform .16s ease; display:inline-block; }
        #ocMenuToggle[aria-expanded="true"] .chev{ transform: rotate(180deg); }

        /* Panneau */
        .menu-panel{
            /* panneau joli */
            background: linear-gradient(180deg,#FFF8F0 0%, #FFFFFF 60%);
            border:1px solid #ffe2bd; border-radius:16px;
            box-shadow:0 8px 28px rgba(255,152,0,.12);
            padding:18px 18px 12px;
            /* grille pour anim d’ouverture/fermeture */
            display:grid; grid-template-rows: 0fr;       /* fermé par défaut */
            overflow: clip;                               /* masque l’anim */
            transition: grid-template-rows .22s ease;
        }
        .menu-panel[data-anim="open"]{ grid-template-rows: 1fr; }
        .menu-panel > .menu-inner{ min-height:0; overflow:hidden; }

        /* Contenu interne */
        .menu-grid{max-width:1200px;margin:0 auto;display:grid;gap:22px;grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
        .menu-group{padding:8px 0;}
        .menu-group + .menu-group{border-top:1px dashed var(--oc-border); padding-top:16px; margin-top:8px}

        /* Titres de section */
        .menu-group h4{
            margin:0 0 10px; font-weight:800; letter-spacing:.2px; color:#ff8b00;
            display:flex;align-items:center;gap:8px;
        }
        .menu-group h4::after{
            content:""; flex:1 1 auto; height:2px; border-radius:2px;
            background:linear-gradient(90deg,#ffd199,transparent); margin-left:8px;
        }

        /* Liens (pills) */
        .menu-group .links{display:flex;flex-wrap:wrap;gap:10px}
        .menu-group .links a{
            display:inline-flex; align-items:center; gap:8px;
            padding:8px 12px; border-radius:999px;
            background:#fff; border:1px solid #ffe3c6; color:var(--oc-text);
            box-shadow:0 2px 10px rgba(0,0,0,.03);
            text-decoration:none;
            transition:transform .12s ease, box-shadow .12s ease, background-color .12s ease, border-color .12s ease;
        }
        .menu-group .links a:hover{
            transform:translateY(-1px);
            box-shadow:0 8px 18px rgba(255,152,0,.15);
            border-color:#ffc78f; background:#fffdf9;
        }
        .menu-group .links a:active{ transform:translateY(0) scale(.99); }
        .menu-group .links a.is-active{
            border-color:#ff9800; background:#fff3e0; font-weight:700;
            box-shadow:0 6px 14px rgba(255,152,0,.18);
        }
        .menu-group .links a:focus-visible{
            outline:0; box-shadow:var(--oc-ring), 0 8px 18px rgba(255,152,0,.12); border-color:#ff9800;
        }

        /* Formulaire de recherche (si utilisé dans le panel) */
        .menu-group.search .search-form{display:flex; gap:8px}
        .menu-group.search input{
            flex:1; height:36px; border-radius:999px; border:1.5px solid var(--oc-border);
            background:#fff7eb; padding:0 12px;
        }
        .menu-group.search button{
            height:36px; border-radius:999px; border:1px solid var(--oc-border);
            background:#fff; padding:0 12px; font-weight:700;
        }

        /* Badges */
        .chip{display:inline-block; margin-left:6px; padding:.05rem .45rem; border-radius:999px; background:#ff9800; color:#fff; font-size:.75rem}

        /* Responsive */
        @media (max-width: 920px){
            .menu-grid{ gap:16px; }
            .menu-group .links a{ padding:7px 11px; }
            .menu-panel{ padding:14px 14px 10px; }
        }
        @media (max-width: 720px){ .nav-container{flex-wrap:wrap} }

        /* Accessibilité – animations */
        @media (prefers-reduced-motion: reduce){
            .menu-group .links a, #ocMenuToggle .chev, .menu-panel{ transition:none !important; }
        }

        /* Dark mode */
        @media (prefers-color-scheme: dark){
            .menu-panel{ background:linear-gradient(180deg,#2b1b00 0%, #1b1205 60%); border-color:#5f3b08; }
            .menu-group h4{ color:#ffb860; }
            .menu-group .links a{ background:var(--oc-pill); border-color:var(--oc-border); color:var(--oc-text); }
            .menu-group .links a:hover{ border-color:#7a4a10; }
            .menu-group .links a.is-active{ background:#3b2914; border-color:#ffb860; }
        }


    </style>

    {% block meta %}{% endblock %}
</head>

<body>
<header class="main-header">
    <div class="header-container">
        <div class="logo-section">
            <a href="{{ path('app_home', {'_locale': app.request.locale}) }}" class="logo-link" aria-label="Orange Chef">
                <picture>
                    <source srcset="{{ asset('images/logo-nav.svg') }}" media="(prefers-color-scheme: dark)">
                    <img src="{{ asset('images/logo-nav.svg') }}"
                         alt="Orange Chef"
                         width="40" height="40"
                         style="height:36px;width:auto;display:block"
                         decoding="async" fetchpriority="high">
                </picture>
                <span class="logo-text">Orange Chef</span>
            </a>
        </div>

        <div class="header-actions">
            {# Changer de langue #}
            {% set currentRoute  = app.request.attributes.get('_route')|default('app_home') %}
            {% set currentParams = app.request.attributes.get('_route_params')|default({}) %}
            {% if currentParams is not iterable %}{% set currentParams = {} %}{% endif %}

            <div class="language-switcher">
                {% for lang in ['fr','en'] %}
                    {% if app.request.locale == lang %}
                        <span class="lang-active">{{ lang == 'fr' ? '🇫🇷' : '🇬🇧' }}</span>
                    {% else %}
                        <a href="{{ path(currentRoute, currentParams|merge({'_locale': lang})) }}"
                           class="lang-link">
                            {{ lang == 'fr' ? '🇫🇷' : '🇬🇧' }}
                        </a>
                    {% endif %}
                {% endfor %}
            </div>

            {# --- Utilisateur --- #}
            {% if app.user %}
                <div class="user-section">
                    {% if app.user.avatar %}
                        <img src="{{ asset('uploads/avatars/' ~ app.user.avatar) }}?v={{ 'now'|date('U') }}" alt="Avatar" class="user-avatar">
                    {% else %}
                        <div class="user-avatar-default">👤</div>
                    {% endif %}
                    <div class="user-info">
                        <span class="user-name">{{ app.user.prenom ?? app.user.email }}</span>
                        <span class="user-role">{{ is_granted('ROLE_ADMIN') ? '👑 Admin' : '🙋 Utilisateur' }}</span>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</header>

{# === NAV : bouton qui ouvre un panneau (dropdown global) === #}
<nav class="main-nav">
    <div class="nav-container">
        <button id="ocMenuToggle" class="btn btn-light" aria-expanded="false" aria-controls="ocMenuPanel">
            <span style="margin-right:.25rem">🍊</span> Menu
            <span class="chev" aria-hidden="true" style="margin-left:.4rem">▾</span>
        </button>

    </div>

    <div id="ocMenuPanel" class="menu-panel" hidden>
        <div class="menu-grid">

            <section class="menu-group">
                <h3>Parcourir</h3>
                <div class="links">
                    {% set route = app.request.attributes.get('_route') %}
                    <a href="{{ path('app_home', {'_locale': app.request.locale}) }}"
                       class="{{ route == 'app_home' ? 'is-active' : '' }}">🏡 Accueil</a>

                    <a href="{{ path('app_recipe_index') }}"
                       class="{{ route starts with 'app_recipe_' ? 'is-active' : '' }}">🍊 Recettes</a>

                    <a href="{{ path('app_contact') }}"
                       class="{{ route == 'app_contact' ? 'is-active' : '' }}">✉️ Contact</a>
                </div>
            </section>

            <section class="menu-group">
                <h3>Mon espace</h3>
                {% if not app.user %}
                    <div class="links">
                        <a href="{{ path('app_login', {'_locale': app.request.locale}) }}">🔐 Connexion</a>
                        <a href="{{ path('app_register', {'_locale': app.request.locale}) }}">📝 Inscription</a>
                    </div>
                {% else %}
                    <div class="links">
                        <a href="{{ path('app_dashboard') }}">📊 Dashboard</a>
                        <a href="{{ path('app_my_recipes') }}">📝 Mes Recettes</a>
                        <a href="{{ path('app_favorites', {'_locale': app.request.locale}) }}">❤️ Favoris</a>
                        <a href="{{ path('app_inventory_index') }}">📦 Mon Stock</a>
                        <a href="{{ path('app_profil') }}">👤 Mon Profil</a>
                        <a href="{{ path('app_logout', {'_locale': app.request.locale}) }}">🚪 Déconnexion</a>
                    </div>
                {% endif %}
            </section>

            {% if is_granted('ROLE_ADMIN') %}
                <section class="menu-group">
                    <h3>Administration</h3>
                    <div class="links">
                        <a href="{{ path('app_user_index') }}">👥 Utilisateurs</a>
                        <a href="{{ path('app_admin_reviews') }}">
                            🛡️ Avis
                            {% set pending = pending_reviews() %}
                            {% if pending > 0 %}<span class="chip">{{ pending }}</span>{% endif %}
                        </a>
                    </div>
                </section>
            {% endif %}

            <section class="menu-group search">
                <h3>Recherche</h3>
                <form action="{{ path('app_recipe_index', {'_locale': app.request.locale}) }}" method="get" class="search-form">
                    <input type="text" name="q" value="{{ app.request.query.get('q') }}"
                           placeholder="Rechercher une recette, une catégorie…">
                    <button type="submit">🔍</button>
                </form>
            </section>

        </div>
    </div>
</nav>

{# --- Flash messages --- #}
{% for type, messages in app.flashes %}
    {% for message in messages %}
        <div class="alert alert-{{ type }}">{{ message }}</div>
    {% endfor %}
{% endfor %}

<main class="main-content">
    <div class="content-container">
        {% block body %}{% endblock %}
    </div>
</main>

<footer class="main-footer" style="background:#0f172a;">
    <div class="container py-1" style="background:transparent!important;box-shadow:none!important;border-radius:0!important;">
        <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">

            {# gauche : logo + marque + année #}
            <div class="d-flex align-items-center gap-2">
                <img src="{{ asset('images/logo-nav.svg') }}" alt="Orange Chef"
                     width="24" height="24" style="height:24px;width:auto;display:block">
                <strong class="text-light">Orange Chef</strong>
                <span class="small text-light opacity-75">· © {{ "now"|date("Y") }}</span>
            </div>

            {# centre : liens courts #}
            <ul class="list-inline mb-0 small">
                <li class="list-inline-item"><a class="link-light text-decoration-none" href="{{ path('app_home', {'_locale': app.request.locale}) }}">Accueil</a></li>
                <li class="list-inline-item"><a class="link-light text-decoration-none" href="{{ path('app_recipe_index') }}">Recettes</a></li>
                <li class="list-inline-item"><a class="link-light text-decoration-none" href="/mentions-legales">Mentions</a></li>
                <li class="list-inline-item"><a class="link-light text-decoration-none" href="/cgu">CGU</a></li>
                <li class="list-inline-item"><a class="link-light text-decoration-none" href="{{ path('app_contact') }}">Contact</a></li>
            </ul>

            {# droite : réseaux sociaux #}
            <div class="d-flex align-items-center gap-2">
                <a class="icon-link link-light" href="#" aria-label="Instagram"><i class="bi bi-instagram"></i></a>
                <a class="icon-link link-light" href="#" aria-label="YouTube"><i class="bi bi-youtube"></i></a>
                <a class="icon-link link-light" href="#" aria-label="TikTok"><i class="bi bi-tiktok"></i></a>
            </div>
        </div>
    </div>
</footer>

{# Petites variables JS #}

<script>
    window.HELP_KB_URL = '{{ path('app_contact', {'_locale': app.request.locale}) }}';
</script>

{# --- JS: Toggle menu global + fermeture hors-clic/Échap --- #}

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const toggle = document.getElementById('ocMenuToggle');
        const panel  = document.getElementById('ocMenuPanel');
        if (!toggle || !panel) return;

        const open  = () => { panel.hidden = false;  toggle.setAttribute('aria-expanded', 'true');  };
        const close = () => { panel.hidden = true;   toggle.setAttribute('aria-expanded', 'false'); };

        toggle.addEventListener('click', (e) => {
            e.preventDefault();
            panel.hidden ? open() : close();
        });

        document.addEventListener('click', (e) => {
            if (panel.hidden) return;
            if (!panel.contains(e.target) && !toggle.contains(e.target)) close();
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') close();
        });
    });
</script>





{% include '_partials/help_widget.html.twig' %}

</body>
</html>
