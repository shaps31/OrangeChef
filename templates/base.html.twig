{# templates/base.html.twig #}
<!DOCTYPE html>
<html lang="{{ app.request.locale|default('fr') }}">
<head>
    <meta charset="UTF-8">

    {# --- SEO / Open Graph --- #}
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Orange Chef">
    <meta property="og:title" content="{% block og_title %}{{ block('title') }}{% endblock %}">
    <meta property="og:description" content="Recettes ensoleillées, astuces anti-gaspi et fraîcheur vitaminée.">
    <meta property="og:image" content="{{ asset('images/og-default.jpg') }}">
    <meta property="og:url" content="{{ app.request.uri|default('') }}">
    <meta name="twitter:card" content="summary_large_image">

    <title>{% block title %}Orange Chef{% endblock %}</title>

    {# --- Favicon & icons --- #}
    <link rel="icon" href="{{ asset('favicon.svg') }}?v=2" type="image/svg+xml">
    <link rel="icon" href="{{ asset('favicon-32.png') }}?v=2" sizes="32x32" type="image/png">
    <link rel="shortcut icon" href="{{ asset('favicon-32.png') }}?v=2"> {# vieux navigateurs #}
    <link rel="apple-touch-icon" href="{{ asset('apple-touch-icon.png') }}?v=2">


    {# --- Bootswatch + Icons (optionnels) --- #}
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/litera/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

    {% block stylesheets %}
        {{ importmap('app') }}
        <link rel="stylesheet" href="{{ asset('styles/theme-citrus.css') }}">

    {% endblock %}

    {% block meta %}{% endblock %}
</head>

<body>
<header class="main-header">
    <div class="header-container">
        <div class="logo-section">
            <a href="{{ path('app_home', {'_locale': app.request.locale}) }}" class="logo-link" aria-label="Orange Chef">
                <picture>
                    <source srcset="{{ asset('images/logo-nav.svg') }}" media="(prefers-color-scheme: dark)">
                    <img src="{{ asset('images/logo-nav.svg') }}"
                         alt="Orange Chef"
                         width="40" height="40"
                         style="height:36px;width:auto;display:block"
                         decoding="async" fetchpriority="high">
                </picture>
                <span class="logo-text">Orange Chef</span>
            </a>
        </div>

        <div class="header-actions">
            {# Changer de langue #}
            {% set currentRoute  = app.request.attributes.get('_route')|default('app_home') %}
            {% set currentParams = app.request.attributes.get('_route_params')|default({}) %}
            {% if currentParams is not iterable %}{% set currentParams = {} %}{% endif %}

            <div class="language-switcher">
                {% for lang in ['fr','en'] %}
                    {% if app.request.locale == lang %}
                        <span class="lang-active">{{ lang == 'fr' ? '🇫🇷' : '🇬🇧' }}</span>
                    {% else %}
                        <a href="{{ path(currentRoute, currentParams|merge({'_locale': lang})) }}"
                           class="lang-link">
                            {{ lang == 'fr' ? '🇫🇷' : '🇬🇧' }}
                        </a>
                    {% endif %}
                {% endfor %}
            </div>

            {# --- Utilisateur --- #}
            {% if app.user %}
                <div class="user-section">
                    {% if app.user.avatar %}
                        <img src="{{ asset('uploads/avatars/' ~ app.user.avatar) }}?v={{ 'now'|date('U') }}" alt="Avatar" class="user-avatar">
                    {% else %}
                        <div class="user-avatar-default">👤</div>
                    {% endif %}
                    <div class="user-info">
                        <span class="user-name">{{ app.user.prenom ?? app.user.email }}</span>
                        <span class="user-role">{{ is_granted('ROLE_ADMIN') ? '👑 Admin' : '🙋 Utilisateur' }}</span>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</header>

{# === NAV : bouton qui ouvre un panneau (dropdown global) === #}
<nav class="main-nav">
    <div class="nav-container">
        <button id="ocMenuToggle" class="btn btn-light" aria-expanded="false" aria-controls="ocMenuPanel">
            <span style="margin-right:.25rem">🍊</span> Menu
            <span class="chev" aria-hidden="true" style="margin-left:.4rem">▾</span>
        </button>

    </div>

    <div id="ocMenuPanel" class="menu-panel" hidden>
        <div class="menu-grid">

            <section class="menu-group">
                <h3>Parcourir</h3>
                <div class="links">
                    {% set route = app.request.attributes.get('_route') %}
                    <a href="{{ path('app_home', {'_locale': app.request.locale}) }}"
                       class="{{ route == 'app_home' ? 'is-active' : '' }}">🏡 Accueil</a>

                    <a href="{{ path('app_recipe_index') }}"
                       class="{{ route starts with 'app_recipe_' ? 'is-active' : '' }}">🍊 Recettes</a>

                    <a href="{{ path('app_contact') }}"
                       class="{{ route == 'app_contact' ? 'is-active' : '' }}">✉️ Contact</a>
                </div>
            </section>

            <section class="menu-group">
                <h3>Mon espace</h3>
                {% if not app.user %}
                    <div class="links">
                        <a href="{{ path('app_login', {'_locale': app.request.locale}) }}">🔐 Connexion</a>
                        <a href="{{ path('app_register', {'_locale': app.request.locale}) }}">📝 Inscription</a>
                    </div>
                {% else %}
                    <div class="links">
                        <a href="{{ path('app_dashboard') }}">📊 Dashboard</a>
                        <a href="{{ path('app_my_recipes') }}">📝 Mes Recettes</a>
                        <a href="{{ path('app_favorites', {'_locale': app.request.locale}) }}">❤️ Favoris</a>
                        <a href="{{ path('app_inventory_index') }}">📦 Mon Stock</a>
                        <a href="{{ path('app_profil') }}">👤 Mon Profil</a>
                        <a href="{{ path('app_logout', {'_locale': app.request.locale}) }}">🚪 Déconnexion</a>
                    </div>
                {% endif %}
            </section>

            {% if is_granted('ROLE_ADMIN') %}
                <section class="menu-group">
                    <h3>Administration</h3>
                    <div class="links">
                        <a href="{{ path('app_user_index') }}">👥 Utilisateurs</a>
                        <a href="{{ path('app_admin_reviews') }}">
                            🛡️ Avis
                            {% set pending = pending_reviews() %}
                            {% if pending > 0 %}<span class="chip">{{ pending }}</span>{% endif %}
                        </a>
                    </div>
                </section>
            {% endif %}

            <section class="menu-group search">
                <h3>Recherche</h3>
                <form action="{{ path('app_recipe_index', {'_locale': app.request.locale}) }}" method="get" class="search-form">
                    <input type="text" name="q" value="{{ app.request.query.get('q') }}"
                           placeholder="Rechercher une recette, une catégorie…">
                    <button type="submit">🔍</button>
                </form>
            </section>

        </div>
    </div>
</nav>

{# --- Flash messages --- #}
{% for type, messages in app.flashes %}
    {% for message in messages %}
        <div class="alert alert-{{ type }}">{{ message }}</div>
    {% endfor %}
{% endfor %}

<main class="main-content">
    <div class="content-container">
        {% block body %}{% endblock %}
    </div>
</main>

<footer class="main-footer">
    <div class="container py-1">
        <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">

            {# gauche : logo + marque + année #}
            <div class="d-flex align-items-center gap-2">
                <img src="{{ asset('images/logo-nav.svg') }}" alt="Orange Chef"
                     width="24" height="24" style="height:24px;width:auto;display:block">
                <strong class="text-light">Orange Chef</strong>
                <span class="small text-light opacity-75">· © {{ "now"|date("Y") }}</span>
            </div>

            {# centre : liens courts #}
            <ul class="list-inline mb-0 small">
                <li class="list-inline-item"><a class="link-light text-decoration-none" href="{{ path('app_home', {'_locale': app.request.locale}) }}">Accueil</a></li>
                <li class="list-inline-item"><a class="link-light text-decoration-none" href="{{ path('app_recipe_index') }}">Recettes</a></li>
                <li class="list-inline-item"><a class="link-light text-decoration-none" href="/mentions-legales">Mentions</a></li>
                <li class="list-inline-item"><a class="link-light text-decoration-none" href="/cgu">CGU</a></li>
                <li class="list-inline-item"><a class="link-light text-decoration-none" href="{{ path('app_contact') }}">Contact</a></li>
            </ul>

            {# droite : réseaux sociaux #}
            <div class="d-flex align-items-center gap-2">
                <a class="icon-link link-light" href="#" aria-label="Instagram"><i class="bi bi-instagram"></i></a>
                <a class="icon-link link-light" href="#" aria-label="YouTube"><i class="bi bi-youtube"></i></a>
                <a class="icon-link link-light" href="#" aria-label="TikTok"><i class="bi bi-tiktok"></i></a>
            </div>
        </div>
    </div>
</footer>

{# Petites variables JS #}

<script>
    <body data-help-kb-url="{{ path('app_contact', {'_locale': app.request.locale}) }}">

</script>


{% include '_partials/help_widget.html.twig' %}



</body>
</html>
