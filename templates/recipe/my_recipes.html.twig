{# templates/recipe/my_recipes.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Mes recettes{% endblock %}

{% block body %}
    <div class="container oc-recipes-page">
        <header class="oc-recipes-head">
            <h1>📝 Mes Recettes</h1>
            <p>Gérez vos créations gourmandes à base d'oranges.</p>
            <a class="btn" href="{{ path('app_recipe_new') }}">➕ Nouvelle recette</a>
        </header>

        <form method="get" class="oc-recipes-filters">
            <label for="sort">Trier par</label>
            <select id="sort" name="sort" class="form-select">
                <option value="newest" {{ sort == 'newest' ? 'selected' : '' }}>🆕 Plus récentes</option>
                <option value="oldest" {{ sort == 'oldest' ? 'selected' : '' }}>🗓️ Plus anciennes</option>
                <option value="title"  {{ sort == 'title'  ? 'selected' : '' }}>🔤 Titre (A→Z)</option>
            </select>
            <button type="submit" class="btn btn-secondary">Appliquer</button>
        </form>

        {% if recipes is empty %}
            <section class="oc-empty">
                <h3>🍊 Aucune recette pour le moment</h3>
                <p>Commencez en créant votre première recette.</p>
                <a href="{{ path('app_recipe_new') }}" class="btn">Créer une recette</a>
            </section>
        {% else %}
            <section class="oc-grid">
                {% for recipe in recipes %}
                    <article class="oc-card">
                        <figure class="oc-card__media">
                            {% if recipe.image %}
                                {% set img = recipe.image %}
                                {% if img starts with 'http' or img starts with 'https' %}
                                    {% set src = img %}
                                {% elseif img starts with 'uploads/' %}
                                    {% set src = asset(img) %}
                                {% else %}
                                    {% set src = asset('uploads/recipes/' ~ img) %}
                                {% endif %}
                                <img src="{{ src }}" alt="{{ recipe.title }}">
                            {% else %}
                                <div class="oc-card__placeholder">🍊</div>
                            {% endif %}
                            <div class="oc-badges">
                                <span class="badge">{{ recipe.categoryIcon }}</span>
                                <span class="badge">{{ recipe.difficultyIcon }}</span>
                            </div>
                        </figure>

                        <div class="oc-card__body">
                            <h3 class="oc-card__title">
                                <a href="{{ path('app_recipe_show', {id: recipe.id}) }}">{{ recipe.title }}</a>
                            </h3>

                            {% set desc = recipe.description ?? '' %}
                            <p class="oc-card__desc">{{ desc }}</p>

                            <div class="oc-card__meta">
                                <div class="oc-meta__stats">
                                    <span>⏱️ {{ recipe.totalTime }}min</span>
                                    <span>👥 {{ recipe.servings }} pers.</span>
                                    <span>👁️ {{ recipe.views }}</span>
                                </div>
                                <div class="oc-meta__actions">
                                    <a class="btn btn-small" href="{{ path('app_recipe_edit', {id: recipe.id}) }}">✏️ Modifier</a>
                                    <a class="btn btn-secondary btn-small" href="{{ path('app_recipe_show', {id: recipe.id}) }}">👀 Voir</a>
                                </div>
                            </div>
                        </div>
                    </article>
                {% endfor %}
            </section>
        {% endif %}

        {% if total_pages is defined and total_pages > 1 %}
            <nav class="pagination">
                <a class="page-btn btn-secondary btn-small"
                   href="{{ path('app_my_recipes', { p: page > 1 ? page - 1 : 1, ps: page_size, sort: sort }) }}"
                   aria-disabled="{{ page == 1 ? 'true' : 'false' }}">⟵ Précédent</a>

                <span class="page-info">Page {{ page }} / {{ total_pages }} ({{ total }} recettes)</span>

                <a class="page-btn btn-secondary btn-small"
                   href="{{ path('app_my_recipes', { p: page < total_pages ? page + 1 : total_pages, ps: page_size, sort: sort }) }}"
                   aria-disabled="{{ page == total_pages ? 'true' : 'false' }}">Suivant ⟶</a>
            </nav>
        {% endif %}
    </div>
{% endblock %}
