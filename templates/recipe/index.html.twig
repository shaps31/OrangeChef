{# templates/recipe/index.html.twig #}
{% extends 'base.html.twig' %}
{% set hide_global_search = true %}
{% trans_default_domain 'messages' %}

{% block title %}üçä Recettes Orange Chef{% endblock %}

{% block body %}
    <div class="container" data-recipes-root>
        <div class="oc-hero">
            <div class="oc-hero__left">
                <h1 class="oc-hero__title">{{ 'recipes.title'|trans }}</h1>
                <p class="oc-hero__tagline">{{ 'recipes.tagline'|trans }}</p>

                <ul class="oc-hero__list">
                    <li>üç∞ G√¢teau moelleux √† l‚Äôorange</li>
                    <li>üçπ Jus d‚Äôorange maison</li>
                    <li>ü•ó Salade vitamin√©e √† l‚Äôorange</li>
                    <li>üçó Poulet sauce orange</li>
                </ul>
            </div>

            <div class="oc-hero__right">
                {% if app.user %}
                    <a href="{{ path('app_recipe_new', {'_locale': app.request.locale}) }}" class="oc-cta">
                        <div class="oc-cta__icon"></div>
                        <div>
                            {{ 'recipes.create'|trans }}
                            <small>{{ 'recipes.create_hint'|trans }}</small>
                        </div>
                    </a>
                {% else %}
                    <a href="{{ path('app_login', {'_locale': app.request.locale}) }}" class="oc-cta oc-cta--ghost">
                        <div class="oc-cta__icon">üîê</div>
                        <div>
                            {{ 'auth.login'|trans }}
                            <small>{{ 'auth.login_hint'|trans }}</small>
                        </div>
                    </a>
                {% endif %}
            </div>
        </div>

        {# --- Filtres --- #}
        {% include '_partials/recipe_filters.html.twig' with {
            action_route: 'app_recipe_index',
            action_params: { _locale: app.request.locale },
            categories: categories|default([]),
            current_category: current_category,
            current_difficulty: current_difficulty,
            sort: sort,
            page_size: page_size,
            current_search: current_search,
            show_density_toggle: true
        } only %}

        {# --- Grille (DRY via partial) --- #}
        <div class="recipes-grid">
            {% for recipe in recipes %}
                {% include '_partials/recipe_card.html.twig' with {
                    recipe: recipe,
                    is_owner: app.user and recipe.author and recipe.author == app.user,
                    compact: false,
                    show_author: true
                } only %}
            {% else %}
                <div class="no-recipes">
                    <div class="empty-state">
                        <h3>{{ 'empty.recipes.title'|trans }}</h3>
                        <p>{{ 'empty.recipes.subtitle'|trans }}</p>
                        {% if app.user %}
                            <a href="{{ path('app_recipe_new', {'_locale': app.request.locale}) }}" class="btn btn-primary">
                                {{ 'recipes.create_first'|trans }}
                            </a>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>

        {# --- Pagination --- #}
        {% include '_partials/pagination.html.twig' with {
            route: 'app_recipe_index',
            page: page,
            total_pages: total_pages,
            total: total,
            window: 2,
            query: {
                _locale: app.request.locale,
                ps: page_size,
                sort: sort,
                category: current_category,
                difficulty: current_difficulty,
                search: current_search
            }
        } only %}
    </div>

    {# JS densit√© compact (m√©morise la pr√©f√©rence) #}
    <script>
        (() => {
            const root = document.querySelector('[data-recipes-root]');
            const btn  = document.getElementById('densityToggle');
            if (!root || !btn) return;

            const savedCompact = localStorage.getItem('recipes_density') === 'compact';
            root.classList.toggle('compact', savedCompact);
            if (savedCompact) {
                btn.setAttribute('aria-pressed','true');
                btn.textContent = 'Mode confortable';
            }

            btn.addEventListener('click', () => {
                const isOn = root.classList.toggle('compact');
                btn.setAttribute('aria-pressed', String(isOn));
                btn.textContent = isOn ? 'Mode confortable' : 'Mode compact';
                localStorage.setItem('recipes_density', isOn ? 'compact' : 'cozy');
            });
        })();
    </script>
{% endblock %}
