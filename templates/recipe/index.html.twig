{# templates/recipe/index.html.twig #}
{% extends 'base.html.twig' %}
{% set hide_global_search = true %}

{% block title %}üçä Recettes Orange Chef{% endblock %}

{% block body %}
    <div class="container" data-recipes-root>
        <div class="recipe-header">
            <h1>üçä Toutes nos Recettes</h1>
            <p>D√©couvrez des recettes d√©licieuses √† base d'oranges !</p>

            {% if app.user %}
                <a href="{{ path('app_recipe_new') }}" class="btn btn-primary">‚ûï Cr√©er une recette</a>
            {% endif %}
        </div>

        {# --- Filtres --- #}
        {% include '_partials/recipe_filters.html.twig' with {
            action_route: 'app_recipe_index',
            action_params: { _locale: app.request.locale },
            categories: categories|default([]),
            current_category: current_category,
            current_difficulty: current_difficulty,
            sort: sort,
            page_size: page_size,
            current_search: current_search,
            show_density_toggle: true
        } only %}

        {# --- Grille (DRY via partial) --- #}
        <div class="recipes-grid">
            {% for recipe in recipes %}
                {% include '_partials/recipe_card.html.twig' with {
                    recipe: recipe,
                    is_owner: app.user and recipe.author and recipe.author == app.user,
                    compact: false,
                    show_author: true
                } only %}
            {% else %}
                <div class="no-recipes">
                    <div class="empty-state">
                        <h3>üçä Aucune recette trouv√©e</h3>
                        <p>Soyez le premier √† partager une d√©licieuse recette √† l'orange !</p>
                        {% if app.user %}
                            <a href="{{ path('app_recipe_new') }}" class="btn btn-primary">Cr√©er ma premi√®re recette</a>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
        {# --- Pagination --- #}
        {% include '_partials/pagination.html.twig' with {
            route: 'app_recipe_index',
            page: page,
            total_pages: total_pages,
            total: total,
            window: 2,
            query: {
                _locale: app.request.locale,
                ps: page_size,
                sort: sort,
                category: current_category,
                difficulty: current_difficulty,
                search: current_search
            }
        } only %}



        {# JS densit√© compact (idempotent) #}
    <script>
        (() => {
            const script = document.currentScript;
            const container =
                (script && script.closest('[data-recipes-root]')) ||
                document.querySelector('[data-recipes-root]') ||
                document.querySelector('.container');
            if (!container) return;

            const densityBtn =
                container.querySelector('#densityToggle') ||
                document.getElementById('densityToggle');
            if (!densityBtn) return;

            densityBtn.addEventListener('click', () => {
                const pressed = densityBtn.getAttribute('aria-pressed') === 'true';
                const next = !pressed;
                densityBtn.setAttribute('aria-pressed', String(next));
                densityBtn.textContent = next ? 'Mode confortable' : 'Mode compact';
                container.classList.toggle('compact', next);
            });
        })();
    </script>
{% endblock %}
