{% extends 'base.html.twig' %}

{% block title %}Mon inventaire d'oranges{% endblock %}

{% block body %}
    <div class="container" data-inventory>
        <div class="inventory-header">
            <h1>üçä Mon inventaire</h1>
            <a class="btn" href="{{ path('app_inventory_new') }}">‚ûï Ajouter du stock</a>
        </div>

        <section class="stats-cards">
            <div class="stat-card">
                <div class="stat-icon">üü†</div>
                <div class="stat-content"><span>Total</span><strong>{{ stats.total }}</strong></div>
            </div>
            <div class="stat-card warn">
                <div class="stat-icon">‚è≥</div>
                <div class="stat-content"><span>Bient√¥t p√©rim√©es</span><strong>{{ stats.expiringSoon }}</strong></div>
            </div>
            <div class="stat-card bad">
                <div class="stat-icon">‚õî</div>
                <div class="stat-content"><span>P√©rim√©es</span><strong>{{ stats.expired }}</strong></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üå±</div>
                <div class="stat-content"><span>Vari√©t√©s</span><strong>{{ stats.varieties }}</strong></div>
            </div>
        </section>

        <div class="table-tools">
            <div class="tabs" role="tablist">
                <button class="tab is-active" data-filter="all" aria-selected="true">Toutes</button>
                <button class="tab" data-filter="ok">OK</button>
                <button class="tab" data-filter="soon">Bient√¥t p√©rim√©es</button>
                <button class="tab" data-filter="expired">P√©rim√©es</button>
            </div>
        </div>

        {% if inventory is empty %}
            <div class="empty-state">
                <h3>Aucun stock pour le moment</h3>
                <p>Ajoutez vos oranges pour suivre les dates limites et √©viter le gaspillage.</p>
                <a class="btn" href="{{ path('app_inventory_new') }}">Ajouter mes premi√®res oranges</a>
            </div>
        {% else %}
            <div class="table-wrap">
                <table class="table">
                    <thead>
                    <tr>
                        <th>Vari√©t√©</th>
                        <th>Quantit√©</th>
                        <th>Expiration</th>
                        <th>√âtat</th>
                        <th class="actions-col"></th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for item in inventory %}
                        {% set status = item.isExpired() ? 'expired' : (item.isExpiringSoon() ? 'soon' : 'ok') %}
                        <tr data-status="{{ status }}">
                            <td>{{ item.variety }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>{{ item.expirationDate ? item.expirationDate|date('d/m/Y') : '-' }}</td>
                            <td>
                                {% if status == 'expired' %}
                                    <span class="badge badge-bad">P√©rim√©</span>
                                {% elseif status == 'soon' %}
                                    <span class="badge badge-warn">Bient√¥t p√©rim√©</span>
                                {% else %}
                                    <span class="badge badge-ok">OK</span>
                                {% endif %}
                            </td>
                            <td class="row-actions">
                                <a class="btn btn-small" href="{{ path('app_inventory_show', {id: item.id}) }}">üëÄ Voir</a>
                                <a class="btn btn-secondary btn-small" href="{{ path('app_inventory_edit', {id: item.id}) }}">‚úèÔ∏è Modifier</a>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}

        <div class="suggestions">
            <h2>üçΩÔ∏è Suggestions de recettes</h2>
            {% if suggestions is empty %}
                <p class="muted">Aucune suggestion pour le moment.</p>
            {% else %}
                <div class="recipes-grid">
                    {% for recipe in suggestions %}
                        <div class="recipe-card mini">
                            <div class="recipe-content">
                                <h3>{{ recipe.title ?? ('Recette #' ~ recipe.id) }}</h3>
                                <a class="btn btn-secondary btn-small" href="{{ path('app_recipe_show', {id: recipe.id}) }}">Voir</a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}
